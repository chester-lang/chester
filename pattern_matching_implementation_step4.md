# Pattern Matching Fix Implementation - Step 4: Update Test to Use Both Parsers

## Problem Statement

After implementing the fixes for pattern matching in the V2 parser, we need to update the `match2` test in `PatternMatchingTest.scala` to use `parseAndCheckBoth` instead of `parseAndCheck`. This will ensure that the test runs against both the V1 and V2 parsers, verifying that our fix has successfully made the V2 parser compatible with the V1 parser for pattern matching with blocks.

## Current Code Analysis

Currently, the `match2` test uses `parseAndCheck`, which only tests with the V1 parser:

```scala
test("match2") {
  val input =
    """
      |  notification match {
      |    case Email(sender, title, _) => {
      |      println(sender);
      |      println(title);
      |    }
      |    case SMS(number, message) => B;
      |    case VoiceRecording(name, link) => C;
      |    case _ => D;
      |  }
      |""".stripMargin
  val expected = OpSeq(
    // ...expected AST structure...
  )
  parseAndCheck(input, expected)  // Only tests with V1 parser
}
```

## Proposed Change

Update the `match2` test to use `parseAndCheckBoth`, which will test with both the V1 and V2 parsers:

```scala
test("match2") {
  val input =
    """
      |  notification match {
      |    case Email(sender, title, _) => {
      |      println(sender);
      |      println(title);
      |    }
      |    case SMS(number, message) => B;
      |    case VoiceRecording(name, link) => C;
      |    case _ => D;
      |  }
      |""".stripMargin
  val expected = OpSeq(
    // ...same expected AST structure...
  )
  parseAndCheckBoth(input, expected)  // Test with both V1 and V2 parsers
}
```

## Justification

This change:
1. Ensures that the test runs against both the V1 and V2 parsers
2. Verifies that our fix has successfully made the V2 parser compatible with the V1 parser
3. Makes the pattern matching test consistent with other tests that use `parseAndCheckBoth`
4. Follows the recommendation in the Chester development documentation to migrate tests to use both parsers when possible

## Implementation Steps

1. Edit `reader/src/test/scala/chester/reader/PatternMatchingTest.scala`
2. Change the last line of the `match2` test from `parseAndCheck(input, expected)` to `parseAndCheckBoth(input, expected)`
3. No other changes are needed

## Testing Plan

After implementing the previous steps (adding context to LexerState, updating `checkForRBraceNewlinePattern`, and enabling context for blocks), run:

```bash
sbt "reader/testOnly chester.reader.PatternMatchingTest"
```

If the test passes, it confirms that our implementation successfully handles pattern matching with blocks in both the V1 and V2 parsers.

## Verification Criteria

1. The `match2` test passes using `parseAndCheckBoth`
2. The ASTs generated by both parsers match the expected structure
3. No regressions in other tests
4. The implementation maintains uniform treatment of all operators without special-casing
